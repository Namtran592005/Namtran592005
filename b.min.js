const wcID = (n) => document.getElementById(n),
  wcU = encodeURIComponent(window.location.href),
  newRequest = function (n = !0) {
    fetch("https://api.websitecarbon.com/b?url=" + wcU)
      .then(function (n) {
        if (!n.ok) throw Error(n);
        return n.json();
      })
      .then(function (e) {
        n && renderResult(e),
          (e.t = new Date().getTime()),
          localStorage.setItem("wcb_" + wcU, JSON.stringify(e));
      })
      .catch(function (n) {
        (wcID("wcb_g").innerHTML = "N/A"),
          console.log(n),
          localStorage.removeItem("wcb_" + wcU);
      });
  },
  renderResult = function (n) {
    (wcID("wcb_g").innerHTML = `ðŸŒ± ${n.c}g`),
      (wcID("wcb_2").innerHTML = `${n.p}% cleaner`);
  },
  wcC =
    "<style>\n#wcb.carbonbadge{\n  --bg:#1a1a1a;\n  --border:#333;\n  --text:#e5e5e5;\n  --green:#22c55e;\n  --accent:#166534;\n  font:12px/1.3 -apple-system,BlinkMacSystemFont,sans-serif;\n  color:var(--text);\n}\n#wcb sub{\n  vertical-align:middle;\n  font-size:.8em;\n}\n#wcb #wcb_p{\n  display:flex;\n  background:var(--bg);\n  border:1px solid var(--border);\n  border-radius:6px;\n  overflow:hidden;\n  width:fit-content;\n  transition:border-color .2s;\n}\n#wcb #wcb_p:hover{\n  border-color:var(--green);\n}\n#wcb #wcb_g{\n  padding:4px 8px;\n  background:var(--bg);\n  color:var(--text);\n  font-weight:500;\n  white-space:nowrap;\n  min-width:60px;\n}\n#wcb #wcb_a{\n  padding:4px 6px;\n  background:var(--accent);\n  color:var(--text);\n  text-decoration:none;\n  font-weight:600;\n  font-size:11px;\n  transition:background .2s;\n}\n#wcb #wcb_a:hover{\n  background:var(--green);\n}\n#wcb #wcb_2{\n  font-size:10px;\n  color:#999;\n  text-align:center;\n  margin-top:2px;\n}\n</style>",
  wcB = wcID("wcb");
if ("fetch" in window) {
  wcB.insertAdjacentHTML("beforeEnd", wcC),
    wcB.insertAdjacentHTML(
      "beforeEnd",
      '<div id="wcb_p"><span id="wcb_g">ðŸŒ± ...</span><a id="wcb_a" target="_blank" rel="noopener" href="https://websitecarbon.com">COâ‚‚</a></div><div id="wcb_2"></div>'
    );
  let n = localStorage.getItem("wcb_" + wcU);
  const e = new Date().getTime();
  if (n) {
    const t = JSON.parse(n);
    renderResult(t), e - t.t > 864e5 && newRequest(!1);
  } else newRequest();
}
